#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
#Область СлужебныеПроцедурыИФункции

// Заполняет список команд печати.
//
// Параметры:
// КомандыПечати – ТаблицаЗначений – состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати.
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	
	// Акт общего технического осмотра
	КомандаПечати = КомандыПечати.Добавить();
	КомандаПечати.МенеджерПечати = "Документ.торо_ВнешнееОснованиеДляРабот";
	КомандаПечати.Идентификатор = "АктОбщегоТехническогоОсмотра";
	КомандаПечати.Представление = НСтр("ru = 'Акт общего технического осмотра'");
	КомандаПечати.СразуНаПринтер = ОбщегоНазначенияВызовСервера.ХранилищеОбщихНастроекЗагрузить(
	"НастройкиТОиР",
	"ПечатьДокументовБезПредварительногоПросмотра",
	Ложь);
	
КонецПроцедуры

// Сформировать печатные формы объектов.
//
// ВХОДЯЩИЕ:
//   ИменаМакетов    - Строка    - Имена макетов, перечисленные через запятую.
//   МассивОбъектов  - Массив    - Массив ссылок на объекты которые нужно распечатать.
//   ПараметрыПечати - Структура - Структура дополнительных параметров печати.
//
// ИСХОДЯЩИЕ:
//   КоллекцияПечатныхФорм - Таблица значений - Сформированные табличные документы.
//   ПараметрыВывода       - Структура        - Параметры сформированных табличных документов.
//
Процедура Печать(МассивОбъектов, ПараметрыПечати, КоллекцияПечатныхФорм, ОбъектыПечати, ПараметрыВывода) Экспорт
	
	Если УправлениеПечатью.НужноПечататьМакет(КоллекцияПечатныхФорм, "АктОбщегоТехническогоОсмотра") Тогда
		
		УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, 
		"АктОбщегоТехническогоОсмотра", 
		"Акт общего технического осмотра", 
		ПечатьОбщегоАкта(МассивОбъектов, ПараметрыПечати));
		
	КонецЕсли;
	
КонецПроцедуры

Функция ПечатьОбщегоАкта(МассивОбъектов, ПараметрыПечати)
	
	ТабДок = Новый ТабличныйДокумент;
	Макет = ПолучитьМакет("АктОбщегоТехническогоОсмотра");
	
	Область = Макет.ПолучитьОбласть("ШапкаАкта");
	Область.Параметры.Организация = МассивОбъектов[0].Организация.Наименование;
	Область.Параметры.ДатаАкта = МассивОбъектов[0].ДатаСоздания;
	ТабДок.Вывести(Область);
	
	Область = Макет.ПолучитьОбласть("КомиссияСостав");
	ТабДок.Вывести(Область);
	
	Область = Макет.ПолучитьОбласть("ЧленыКомиссии");
	ТабДок.Вывести(Область);
	
	Область = Макет.ПолучитьОбласть("ФормулировкаАкта");
	Область.Параметры.Организация = МассивОбъектов[0].Организация.Наименование;
	ТабДок.Вывести(Область);
	
	
	Область = Макет.ПолучитьОбласть("ШапкаТаблицы");
	ТабДок.Вывести(Область);
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ТаблицаЗначений.ОбъектРемонта,
	|	ТаблицаЗначений.Описание,
	|	ТаблицаЗначений.ПлановаяДатаРемонта
	|ПОМЕСТИТЬ ВТ
	|ИЗ
	|	&ТаблицаЗначений КАК ТаблицаЗначений
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ.ОбъектРемонта,
	|	ВТ.Описание КАК ОписаниеДефекта,
	|	ВТ.ПлановаяДатаРемонта КАК ДатаРемонтаПлан,
	|	ВТ.ОбъектРемонта.Организация КАК Организация
	|ИЗ
	|	ВТ КАК ВТ
	|ИТОГИ ПО
	|	Организация";
	Запрос.УстановитьПараметр("ТаблицаЗначений", МассивОбъектов[0].ОбследованноеОборудование.Выгрузить());
	ВыборкаПоОрг = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	ОбластьГруппировки = Макет.ПолучитьОбласть("ПодразделениеСтрока");
	ОбластьОР = Макет.ПолучитьОбласть("ОбъектРемонтаСтрока");
	Сч = 1;
	ТабДок.НачатьАвтогруппировкуСтрок();
	Пока ВыборкаПоОрг.Следующий() Цикл
		ОбластьГруппировки.Параметры.НомерГруппировки = Сч;		
		ОбластьГруппировки.Параметры.ПодразделениеОбъектаРемонта = ВыборкаПоОрг.Организация;
		ТабДок.Вывести(ОбластьГруппировки, 0);
		Сч = Сч + 1;
		СчОР = 1;
		Выборка = ВыборкаПоОрг.Выбрать();
		Пока Выборка.Следующий() Цикл
			ОбластьОР.Параметры.НомерОбъекта = СчОР;
			ОбластьОР.Параметры.Заполнить(Выборка);
			ОбластьОР.Параметры.ОбъектРемонта = торо_ЗаполнениеДокументов.ПолучитьПредоставленияОРДляПечати(Выборка.ОбъектРемонта);
			ТабДок.Вывести(ОбластьОР, 1);
			СчОР = СчОР + 1;
		КонецЦикла;
	КонецЦикла;
	ТабДок.ЗакончитьАвтогруппировкуСтрок();
	
	ТабДок.АвтоМасштаб = Истина;
	
	ТабДок.ТолькоПросмотр = Истина;
	Возврат ТабДок;
	
КонецФункции

Процедура ПриОпределенииНастроекВерсионированияОбъектов(Настройки) Экспорт
	
	Настройки.ПриПолученииСлужебныхРеквизитов = Истина;
	
КонецПроцедуры

Процедура ПриПолученииСлужебныхРеквизитов(Реквизиты) Экспорт
	
	Реквизиты.Добавить("СтатусДокумента");
	Реквизиты.Добавить("ИсторияСтатусов.*");
	Реквизиты.Добавить("Согласующие.*");
		
КонецПроцедуры

#КонецОбласти

#КонецЕсли